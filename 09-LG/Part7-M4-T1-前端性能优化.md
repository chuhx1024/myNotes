### 前端性能优化
#### 基础概念
- 什么是 web 性能
    - 打开速度
    - 动画效果
    - 表单提交
    - 列表滚动
    - 页面切换
- MDN 上 web 性能的定义
    - 网站或者应用程序的客观度量和可感知的用户体验
        - 减少整体加载时间: (减小文件体积, 减少 http 请求, 使用预加载)
        - 是网站尽快可用: (仅加载首屏内容, 其他内容根据需求懒加载)
        - 平滑和交互性: (使用功能css 代替 js 动画, 减少 UI 重绘)
        - 感知表现: 你的网页可能 不可能做的更快 但是使用 loading 动画, 进度条, 骨架屏 等提示  显得 有点快
        - 性能测定: 性能指标, 性能测试, 性能监控(多好才算好  多差才算差)
- 为什么要关注 web 性能
    - 用户留存率
    - 网站转化率
    - 体验和传播
    - 搜索排名
    - 客户投诉
    - 提升工作绩效(自己的)

- 如何进行 web 性能优化
    - 首先要了解性能指标: 多块才算快
    - 使用专业的工具可量化评估出网站或者应用的性能表现
    - 然后立足于网站页面响应的生命周期, 分析出造成较差性能表现的原因
    - 最后进行技术改造, 可行性分析工具等具体优化实时
    - 迭代优化

#### 性能指标
- RAIL 性能模型( Response, Animation, Idle(空闲), Load) Google Chrome 团队在 2015年提出的性能模型 用于提升浏览器的用户体验和性能
    - Response: 要尽可能的快, 100ms 以内(最起码要给个 loading 效果等)
    - Animation: 每帧 16ms (也就每秒60帧)进行渲染 这样可以保持动画的一致性 避免卡顿
    - Idle: 尽量不要有 大于 50ms 的长任务(长任务会造成阻塞)
    - Load: 首次5s 以后2s 的时间完成你的网站加载 并可以进行用户交互
- 基于用户体验的核心指标(google 制定的一些标准)
    - 首次内容绘制
    - 最大内容绘制: img 

- 新一代性能指标: Web Vitals (google 制定的一些标准)
    - 主要关注三个指标
        - LCP(加载性能)
        - FID(交互性)
        - CLS(视觉稳定性)

#### 测量工具
##### 使用 web-vitals 库
```js
npm i web-vitals
import { getLCP, getFID, getCLS} from 'web-vitals'

getLCP()
```
- 浏览器 DevTools 调试工具
    - 在 chrome 商店安装 Web Vitals
    - 可以直接看到 LCP FID CLS 的时间 (绿色比较好)
    - 网络监控分析
    - 性能监控分析

##### 灯塔(Lighthouse)
- 概念
    - 是google 开发并开源的 web 性能测试工具 用于改进网络应用的质量
    - 可以作为 chrome 扩展程序运行, 或者从命令行运行
    - 只用给一个网址  它就可以生成一个页面性能的报告
    - 网站整体质量评估, 并给出优化建议

- 优化手段
    - 移除无用的 js 等资源
    - 开启 gzip 代码压缩
    - 如果可以 使用小图片
    - 如果使用 webpack 打包  生成环境 使用 production 模式



##### WebPageTest
- 官网: www.webpagetest.org
    - 多测试地点
    - 全面的性能报告

#### 优化方向
- 发送请求 到 收到响应的优化: DNS查询, HTTP长连接, HTTP2, HTTP 缓存等
- 关键渲染路径优化, 比如是否存在不必要的重绘和回流
- 加载过程的优化, 比如延迟加载 是否有不需要在首屏展示的非关键信息, 
- 资源优化, 比如 图片, 视频等不同的格式会有不同的使用场景, 
- 构建优化, 比如压缩合并, webpack 构建优化

#### 性能检测的一些认知
- 不要通过单一的指标就衡量网站的性能体验
- 不要通过一次检测就得出网站性能表现的客观结果(多次做 求平均值)
- 不要仅在开发环境中模拟进行性能检测

#### 前端页面的生命周期
- 用户输入地址栏 到返回页面 经历的过程
    - 浏览器收到 URL 到请求网络开启
        -包含: 协议头(http,ftp, Telnet); 主机域名/IP地址; Port; Path; Query; 锚点
    - 一个完整的 Http 请求发出
        - DNS解析
            - 浏览器 DNS 缓存
            - 系统自身 DNS 缓存
            - hosts 文件
            - 本地域名服务器
            - 网络域名服务器
            - 在没有 就报错

        - 通信线路的建立
            - 三次握手 建立连接 
                - 1. 浏览器问 服务器准备好了?  准备好了! 
                - 2. 服务器反过来问 准备好了 准备好了
                - 3. 返回数据
            - 四次挥手 断开连接
                1. 
    - 服务器接收到请求并转到具体的处理后台
    - 前后台之间的 HTTP交互和设计的缓存机制
    - 浏览器收到数据包后的关键渲染路径
    - JS 引擎的解析过程

#### 具体的优化措施
##### 请求响应的优化
- 核心思想
    - 更好的连接传输效率
    - 更少的请求数量
    - 更小的资源大小
    - 合适的缓存策略
- 最佳实践
    - 减少DNS查找
    - 重用 TCP 连接
    - 减少 HTTP 重定向
    - 压缩传输资源: Gzip 图片压缩
    - 使用缓存
    - 使用 CDN (内容分发网络) 把资源放在离用户最近的地方
    - 删除没有必要的请求资源
    - 在客户端缓存资源
    - 内容在传输前先压缩
    - 预渲染
##### DNS 解析优化
- 减少 DNS的请求次数
- 进行 DNS 预获取: DNS Prefetch

```js
// 放置再 html 页面的 head 里
<link rel="dns-prefetch" href="//f.ccc.com">
```

##### HTTP 长连接
- 

